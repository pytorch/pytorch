#include <gtest/gtest.h>
#include <ATen/native/special_functions/laguerre_polynomial_l.h>

template<typename T1>
struct laguerre_polynomial_l_fixture {
  T1 f0;
  unsigned int n;
  T1 x;
  T1 f;
};

const laguerre_polynomial_l_fixture<double> fixture_0001[31] = {
    {1.0000000000000000, 0, -50.000000000000000, 0.0},
    {1.0000000000000000, 0, -45.000000000000000, 0.0},
    {1.0000000000000000, 0, -40.000000000000000, 0.0},
    {1.0000000000000000, 0, -35.000000000000000, 0.0},
    {1.0000000000000000, 0, -30.000000000000000, 0.0},
    {1.0000000000000000, 0, -25.000000000000000, 0.0},
    {1.0000000000000000, 0, -20.000000000000000, 0.0},
    {1.0000000000000000, 0, -15.000000000000000, 0.0},
    {1.0000000000000000, 0, -10.000000000000000, 0.0},
    {1.0000000000000000, 0, -5.0000000000000000, 0.0},
    {1.0000000000000000, 0, 0.0000000000000000, 0.0},
    {1.0000000000000000, 0, 5.0000000000000000, 0.0},
    {1.0000000000000000, 0, 10.000000000000000, 0.0},
    {1.0000000000000000, 0, 15.000000000000000, 0.0},
    {1.0000000000000000, 0, 20.000000000000000, 0.0},
    {1.0000000000000000, 0, 25.000000000000000, 0.0},
    {1.0000000000000000, 0, 30.000000000000000, 0.0},
    {1.0000000000000000, 0, 35.000000000000000, 0.0},
    {1.0000000000000000, 0, 40.000000000000000, 0.0},
    {1.0000000000000000, 0, 45.000000000000000, 0.0},
    {1.0000000000000000, 0, 50.000000000000000, 0.0},
    {1.0000000000000000, 0, 55.000000000000000, 0.0},
    {1.0000000000000000, 0, 60.000000000000000, 0.0},
    {1.0000000000000000, 0, 65.000000000000000, 0.0},
    {1.0000000000000000, 0, 70.000000000000000, 0.0},
    {1.0000000000000000, 0, 75.000000000000000, 0.0},
    {1.0000000000000000, 0, 80.000000000000000, 0.0},
    {1.0000000000000000, 0, 85.000000000000000, 0.0},
    {1.0000000000000000, 0, 90.000000000000000, 0.0},
    {1.0000000000000000, 0, 95.000000000000000, 0.0},
    {1.0000000000000000, 0, 100.00000000000000, 0.0},
};

const double tolerance_0001 = 2.5000000000000020e-13;

const laguerre_polynomial_l_fixture<double> fixture_0002[31] = {
    {51.000000000000000, 1, -50.000000000000000, 0.0},
    {46.000000000000000, 1, -45.000000000000000, 0.0},
    {41.000000000000000, 1, -40.000000000000000, 0.0},
    {36.000000000000000, 1, -35.000000000000000, 0.0},
    {31.000000000000000, 1, -30.000000000000000, 0.0},
    {26.000000000000000, 1, -25.000000000000000, 0.0},
    {21.000000000000000, 1, -20.000000000000000, 0.0},
    {16.000000000000000, 1, -15.000000000000000, 0.0},
    {11.000000000000000, 1, -10.000000000000000, 0.0},
    {6.0000000000000000, 1, -5.0000000000000000, 0.0},
    {1.0000000000000000, 1, 0.0000000000000000, 0.0},
    {-4.0000000000000000, 1, 5.0000000000000000, 0.0},
    {-9.0000000000000000, 1, 10.000000000000000, 0.0},
    {-14.000000000000000, 1, 15.000000000000000, 0.0},
    {-19.000000000000000, 1, 20.000000000000000, 0.0},
    {-24.000000000000000, 1, 25.000000000000000, 0.0},
    {-29.000000000000000, 1, 30.000000000000000, 0.0},
    {-34.000000000000000, 1, 35.000000000000000, 0.0},
    {-39.000000000000000, 1, 40.000000000000000, 0.0},
    {-44.000000000000000, 1, 45.000000000000000, 0.0},
    {-49.000000000000000, 1, 50.000000000000000, 0.0},
    {-54.000000000000000, 1, 55.000000000000000, 0.0},
    {-59.000000000000000, 1, 60.000000000000000, 0.0},
    {-64.000000000000000, 1, 65.000000000000000, 0.0},
    {-69.000000000000000, 1, 70.000000000000000, 0.0},
    {-74.000000000000000, 1, 75.000000000000000, 0.0},
    {-79.000000000000000, 1, 80.000000000000000, 0.0},
    {-84.000000000000000, 1, 85.000000000000000, 0.0},
    {-89.000000000000000, 1, 90.000000000000000, 0.0},
    {-94.000000000000000, 1, 95.000000000000000, 0.0},
    {-99.000000000000000, 1, 100.00000000000000, 0.0},
};

const double tolerance_0002 = 2.5000000000000020e-13;

const laguerre_polynomial_l_fixture<double> fixture_0003[31] = {
    {1351.0000000000016, 2, -50.000000000000000, 0.0},
    {1103.5000000000011, 2, -45.000000000000000, 0.0},
    {881.00000000000102, 2, -40.000000000000000, 0.0},
    {683.50000000000080, 2, -35.000000000000000, 0.0},
    {511.00000000000057, 2, -30.000000000000000, 0.0},
    {363.50000000000040, 2, -25.000000000000000, 0.0},
    {241.00000000000026, 2, -20.000000000000000, 0.0},
    {143.50000000000017, 2, -15.000000000000000, 0.0},
    {71.000000000000085, 2, -10.000000000000000, 0.0},
    {23.500000000000025, 2, -5.0000000000000000, 0.0},
    {1.0000000000000000, 2, 0.0000000000000000, 0.0},
    {3.5000000000000000, 2, 5.0000000000000000, 0.0},
    {31.000000000000000, 2, 10.000000000000000, 0.0},
    {83.500000000000000, 2, 15.000000000000000, 0.0},
    {161.00000000000000, 2, 20.000000000000000, 0.0},
    {263.50000000000000, 2, 25.000000000000000, 0.0},
    {391.00000000000000, 2, 30.000000000000000, 0.0},
    {543.50000000000000, 2, 35.000000000000000, 0.0},
    {721.00000000000000, 2, 40.000000000000000, 0.0},
    {923.50000000000000, 2, 45.000000000000000, 0.0},
    {1151.0000000000000, 2, 50.000000000000000, 0.0},
    {1403.5000000000000, 2, 55.000000000000000, 0.0},
    {1681.0000000000000, 2, 60.000000000000000, 0.0},
    {1983.5000000000000, 2, 65.000000000000000, 0.0},
    {2311.0000000000000, 2, 70.000000000000000, 0.0},
    {2663.5000000000000, 2, 75.000000000000000, 0.0},
    {3041.0000000000000, 2, 80.000000000000000, 0.0},
    {3443.5000000000000, 2, 85.000000000000000, 0.0},
    {3871.0000000000000, 2, 90.000000000000000, 0.0},
    {4323.5000000000000, 2, 95.000000000000000, 0.0},
    {4801.0000000000000, 2, 100.00000000000000, 0.0},
};

const double tolerance_0003 = 2.5000000000000020e-13;

const laguerre_polynomial_l_fixture<double> fixture_0004[31] = {
    {4127334.3333333451, 5, -50.000000000000000, 0.0},
    {2554257.2500000070, 5, -45.000000000000000, 0.0},
    {1501534.3333333374, 5, -40.000000000000000, 0.0},
    {828071.83333333570, 5, -35.000000000000000, 0.0},
    {420901.00000000111, 5, -30.000000000000000, 0.0},
    {192053.08333333387, 5, -25.000000000000000, 0.0},
    {75434.333333333547, 5, -20.000000000000000, 0.0},
    {23701.000000000062, 5, -15.000000000000000, 0.0},
    {5134.3333333333476, 5, -10.000000000000000, 0.0},
    {515.58333333333474, 5, -5.0000000000000000, 0.0},
    {1.0000000000000000, 5, 0.0000000000000000, 0.0},
    {-3.1666666666666665, 5, 5.0000000000000000, 0.0},
    {34.333333333333329, 5, 10.000000000000000, 0.0},
    {-355.25000000000000, 5, 15.000000000000000, 0.0},
    {-4765.6666666666670, 5, 20.000000000000000, 0.0},
    {-23040.666666666664, 5, 25.000000000000000, 0.0},
    {-74399.000000000000, 5, 30.000000000000000, 0.0},
    {-190559.41666666663, 5, 35.000000000000000, 0.0},
    {-418865.66666666663, 5, 40.000000000000000, 0.0},
    {-825411.50000000000, 5, 45.000000000000000, 0.0},
    {-1498165.6666666665, 5, 50.000000000000000, 0.0},
    {-2550096.9166666670, 5, 55.000000000000000, 0.0},
    {-4122299.0000000000, 5, 60.000000000000000, 0.0},
    {-6387115.6666666670, 5, 65.000000000000000, 0.0},
    {-9551265.6666666679, 5, 70.000000000000000, 0.0},
    {-13858967.750000000, 5, 75.000000000000000, 0.0},
    {-19595065.666666664, 5, 80.000000000000000, 0.0},
    {-27088153.166666668, 5, 85.000000000000000, 0.0},
    {-36713699.000000000, 5, 90.000000000000000, 0.0},
    {-48897171.916666657, 5, 95.000000000000000, 0.0},
    {-64117165.666666664, 5, 100.00000000000000, 0.0},
};

const double tolerance_0004 = 2.5000000000000020e-13;

const laguerre_polynomial_l_fixture<double> fixture_0005[31] = {
    {148202850236.44952, 10, -50.000000000000000, 0.0},
    {60746492969.066284, 10, -45.000000000000000, 0.0},
    {22762241409.818306, 10, -40.000000000000000, 0.0},
    {7637743846.9309740, 10, -35.000000000000000, 0.0},
    {2229405729.5714245, 10, -30.000000000000000, 0.0},
    {542484600.57406616, 10, -25.000000000000000, 0.0},
    {102934703.64550248, 10, -20.000000000000000, 0.0},
    {13579390.048549078, 10, -15.000000000000000, 0.0},
    {991533.09876543062, 10, -10.000000000000000, 0.0},
    {22054.640149636201, 10, -5.0000000000000000, 0.0},
    {1.0000000000000000, 10, 0.0000000000000000, 0.0},
    {1.7562761794532631, 10, 5.0000000000000000, 0.0},
    {27.984126984126977, 10, 10.000000000000000, 0.0},
    {-237.51841517857147, 10, 15.000000000000000, 0.0},
    {3227.8077601410932, 10, 20.000000000000000, 0.0},
    {-45786.199797453693, 10, 25.000000000000000, 0.0},
    {15129.571428571455, 10, 30.000000000000000, 0.0},
    {7764800.8179494590, 10, 35.000000000000000, 0.0},
    {79724066.608465582, 10, 40.000000000000000, 0.0},
    {469865425.65122765, 10, 45.000000000000000, 0.0},
    {2037190065.3738980, 10, 50.000000000000000, 0.0},
    {7187828002.9825764, 10, 55.000000000000000, 0.0},
    {21804200401.000000, 10, 60.000000000000000, 0.0},
    {58854343015.616211, 10, 65.000000000000000, 0.0},
    {144688291819.51855, 10, 70.000000000000000, 0.0},
    {329425241736.70038, 10, 75.000000000000000, 0.0},
    {703324772760.08276, 10, 80.000000000000000, 0.0},
    {1421627560118.6157, 10, 85.000000000000000, 0.0},
    {2741055412243.8569, 10, 90.000000000000000, 0.0},
    {5071986977681.8652, 10, 95.000000000000000, 0.0},
    {9051283795429.5723, 10, 100.00000000000000, 0.0},
};

const double tolerance_0005 = 5.0000000000000039e-13;

const laguerre_polynomial_l_fixture<double> fixture_0006[31] = {
    {1.6222681676153152e+18, 20, -50.000000000000000, 0.0},
    {3.2988612079281126e+17, 20, -45.000000000000000, 0.0},
    {57863469222022600., 20, -40.000000000000000, 0.0},
    {8476928220083334.0, 20, -35.000000000000000, 0.0},
    {991779643418206.62, 20, -30.000000000000000, 0.0},
    {86821153192744.312, 20, -25.000000000000000, 0.0},
    {5140049229892.0127, 20, -20.000000000000000, 0.0},
    {173311338038.44739, 20, -15.000000000000000, 0.0},
    {2374431369.3674054, 20, -10.000000000000000, 0.0},
    {5508529.1487320997, 20, -5.0000000000000000, 0.0},
    {1.0000000000000000, 20, 0.0000000000000000, 0.0},
    {2.0202257444769134, 20, 5.0000000000000000, 0.0},
    {-11.961333867812119, 20, 10.000000000000000, 0.0},
    {-50.151037960139455, 20, 15.000000000000000, 0.0},
    {2829.4728613531743, 20, 20.000000000000000, 0.0},
    {-11583.947899113540, 20, 25.000000000000000, 0.0},
    {-18439.424502520938, 20, 30.000000000000000, 0.0},
    {-38838.223606979285, 20, 35.000000000000000, 0.0},
    {24799805.877530713, 20, 40.000000000000000, 0.0},
    {-673953823.59913278, 20, 45.000000000000000, 0.0},
    {7551960453.7672548, 20, 50.000000000000000, 0.0},
    {31286508510.614746, 20, 55.000000000000000, 0.0},
    {-1379223608444.9155, 20, 60.000000000000000, 0.0},
    {-6692517968212.9717, 20, 65.000000000000000, 0.0},
    {165423821874449.94, 20, 70.000000000000000, 0.0},
    {3082390018008546.5, 20, 75.000000000000000, 0.0},
    {29500368536981676., 20, 80.000000000000000, 0.0},
    {2.0353526354974186e+17, 20, 85.000000000000000, 0.0},
    {1.1292309514432901e+18, 20, 90.000000000000000, 0.0},
    {5.3239262855563100e+18, 20, 95.000000000000000, 0.0},
    {2.2061882785931735e+19, 20, 100.00000000000000, 0.0},
};

const double tolerance_0006 = 5.0000000000000039e-13;

const laguerre_polynomial_l_fixture<double> fixture_0007[31] = {
    {1.2715347684526410e+33, 50, -50.000000000000000, 0.0},
    {5.1832319180272564e+31, 50, -45.000000000000000, 0.0},
    {1.6226137645774477e+30, 50, -40.000000000000000, 0.0},
    {3.6943260990073690e+28, 50, -35.000000000000000, 0.0},
    {5.6750167239142537e+26, 50, -30.000000000000000, 0.0},
    {5.2772922471763376e+24, 50, -25.000000000000000, 0.0},
    {2.5138332587674646e+22, 50, -20.000000000000000, 0.0},
    {4.6271108736614826e+19, 50, -15.000000000000000, 0.0},
    {18975711870207952., 50, -10.000000000000000, 0.0},
    {418890077041.54413, 50, -5.0000000000000000, 0.0},
    {1.0000000000000000, 50, 0.0000000000000000, 0.0},
    {1.4735258819430543, 50, 5.0000000000000000, 0.0},
    {17.534183446338233, 50, 10.000000000000000, 0.0},
    {-195.62436619077380, 50, 15.000000000000000, 0.0},
    {980.26961889791028, 50, 20.000000000000000, 0.0},
    {24812.277673870878, 50, 25.000000000000000, 0.0},
    {293000.50735962362, 50, 30.000000000000000, 0.0},
    {2316195.5013375278, 50, 35.000000000000000, 0.0},
    {-14896937.968694873, 50, 40.000000000000000, 0.0},
    {-502066598.00813466, 50, 45.000000000000000, 0.0},
    {2513677852.6916871, 50, 50.000000000000000, 0.0},
    {45129675503.538910, 50, 55.000000000000000, 0.0},
    {-883876565337.99219, 50, 60.000000000000000, 0.0},
    {9361319947203.8418, 50, 65.000000000000000, 0.0},
    {-80967880733583.234, 50, 70.000000000000000, 0.0},
    {717391079438942.62, 50, 75.000000000000000, 0.0},
    {-8217471769564841.0, 50, 80.000000000000000, 0.0},
    {1.2595276229009978e+17, 50, 85.000000000000000, 0.0},
    {-2.1140031308048891e+18, 50, 90.000000000000000, 0.0},
    {3.2438187475835134e+19, 50, 95.000000000000000, 0.0},
    {-3.9710103487094692e+20, 50, 100.00000000000000, 0.0},
};

const double tolerance_0007 = 2.5000000000000020e-13;

const laguerre_polynomial_l_fixture<double> fixture_0008[31] = {
    {3.0264233740840872e+50, 100, -50.000000000000000, 0.0},
    {1.7309686244169686e+48, 100, -45.000000000000000, 0.0},
    {6.6888774826696680e+45, 100, -40.000000000000000, 0.0},
    {1.6141317681724538e+43, 100, -35.000000000000000, 0.0},
    {2.1828281247669722e+40, 100, -30.000000000000000, 0.0},
    {1.4151114137140473e+37, 100, -25.000000000000000, 0.0},
    {3.4598617843941908e+33, 100, -20.000000000000000, 0.0},
    {2.1295214407552188e+29, 100, -15.000000000000000, 0.0},
    {1.5001830668987728e+24, 100, -10.000000000000000, 0.0},
    {1.5860471069810342e+17, 100, -5.0000000000000000, 0.0},
    {1.0000000000000000, 100, 0.0000000000000000, 0.0},
    {1.4555271625328801, 100, 5.0000000000000000, 0.0},
    {13.277662844303450, 100, 10.000000000000000, 0.0},
    {91.737038454342454, 100, 15.000000000000000, 0.0},
    {1854.0367283243388, 100, 20.000000000000000, 0.0},
    {-11281.698886837261, 100, 25.000000000000000, 0.0},
    {170141.86987046551, 100, 30.000000000000000, 0.0},
    {-2950092.7025822806, 100, 35.000000000000000, 0.0},
    {-7272442.3156006960, 100, 40.000000000000000, 0.0},
    {295697471.90876162, 100, 45.000000000000000, 0.0},
    {4847420871.2690506, 100, 50.000000000000000, 0.0},
    {59406998102.392288, 100, 55.000000000000000, 0.0},
    {693492765740.29688, 100, 60.000000000000000, 0.0},
    {6606192010150.3154, 100, 65.000000000000000, 0.0},
    {17125518672239.770, 100, 70.000000000000000, 0.0},
    {-870493767065150.12, 100, 75.000000000000000, 0.0},
    {-13763178176383768., 100, 80.000000000000000, 0.0},
    {30667078414479584., 100, 85.000000000000000, 0.0},
    {2.1307220490380173e+18, 100, 90.000000000000000, 0.0},
    {-7.2706523009007821e+18, 100, 95.000000000000000, 0.0},
    {-2.6292260693068916e+20, 100, 100.00000000000000, 0.0},
};

const double tolerance_0008 = 5.0000000000000029e-12;

template<typename T1, unsigned int T2>
void
test(const laguerre_polynomial_l_fixture<T1>(&fixtures)[T2], T1 tolerance) {
  const T1 epsilon = std::numeric_limits<T1>::epsilon();

  T1 maximum_absolute_difference = T1(-1);
  T1 maximum_absolute_fraction = T1(-1);

  auto error = 0;

  for (auto fixture: fixtures) {
    const T1 g = aten::native::special_functions::laguerre_polynomial_l<T1>(fixture.n, fixture.x);

    if (std::isnan(g) && !error) {
      error = 1;
    }

    if (!std::isnan(g)) {
      const T1 f = fixture.f0;

      const auto difference = g - f;

      const auto absolute_difference = std::abs(difference);

      if (absolute_difference > maximum_absolute_difference) {
        maximum_absolute_difference = absolute_difference;
      }

      const auto abs_f = std::abs(f);
      const auto abs_g = std::abs(g);

      if (abs_f > T1(10) * epsilon && abs_g > T1(10) * epsilon) {
        const auto fraction = difference / f;

        const auto absolute_fraction = std::abs(fraction);

        if (absolute_fraction > maximum_absolute_fraction) {
          maximum_absolute_fraction = absolute_fraction;
        }
      }
    }
  }

  EXPECT_TRUE(!error && maximum_absolute_fraction < tolerance);
}

TEST(LaguerrePolynomialLTest, GSL) {
  test(fixture_0001, tolerance_0001);
  test(fixture_0002, tolerance_0002);
  test(fixture_0003, tolerance_0003);
  test(fixture_0004, tolerance_0004);
  test(fixture_0005, tolerance_0005);
  test(fixture_0006, tolerance_0006);
  test(fixture_0007, tolerance_0007);
  test(fixture_0008, tolerance_0008);
}