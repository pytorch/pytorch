From ea73577c3abfc44988f137d715a61145ff2577f6 Mon Sep 17 00:00:00 2001
From: Luca Wehrstedt <lcw@fb.com>
Date: Mon, 12 Jan 2026 05:39:19 -0800
Subject: [PATCH] Fix offline build mode

---
 hopper/setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/hopper/setup.py b/hopper/setup.py
index 95729ed..e8f515e 100644
--- a/hopper/setup.py
+++ b/hopper/setup.py
@@ -447,7 +447,7 @@ if not SKIP_CUDA_BUILD:
     # We want to use the nvcc front end from 12.6 however, since if we use nvcc 12.8
     # Cutlass 3.8 will expect the new data types in cuda.h from CTK 12.8, which we don't have.
     # For CUDA 13.0+, use system nvcc instead of downloading CUDA 12.x toolchain
-    if bare_metal_version >= Version("12.3") and bare_metal_version < Version("13.0") and bare_metal_version != Version("12.8"):
+    if not is_offline_build() and bare_metal_version >= Version("12.3") and bare_metal_version < Version("13.0") and bare_metal_version != Version("12.8"):
         download_and_copy(
             name="nvcc",
             src_func=lambda system, arch, version: f"cuda_nvcc-{system}-{arch}-{version}-archive/bin",
-- 
2.47.3

