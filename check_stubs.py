#!/usr/bin/env python3
"""Check if PyTorch stub files (.pyi) exist."""

from pathlib import Path
import sys

REPO_ROOT = Path(__file__).parent.absolute()

# Core stub files generated by tools/pyi/gen_pyi.py
CORE_STUBS = [
    "torch/__init__.pyi",
    "torch/_C/__init__.pyi",
    "torch/_C/_VariableFunctions.pyi",
    "torch/_VF.pyi",
    "torch/return_types.pyi",
    "torch/nn/functional.pyi",
    "torch/_C/_nn.pyi",
]

def main() -> int:
    print("Checking PyTorch stub files...\n")

    missing = []
    present = []

    for stub_path in CORE_STUBS:
        full_path = REPO_ROOT / stub_path
        if full_path.exists():
            size = full_path.stat().st_size
            print(f"✓ {stub_path:<40} ({size:,} bytes)")
            present.append(stub_path)
        else:
            print(f"✗ {stub_path:<40} (missing)")
            missing.append(stub_path)

    print(f"\nSummary: {len(present)} present, {len(missing)} missing")

    if missing:
        print("\nMissing files:")
        for stub in missing:
            print(f"  - {stub}")
        print("\nTo generate missing stub files, run:")
        print("  python -m tools.pyi.gen_pyi \\")
        print("    --native-functions-path aten/src/ATen/native/native_functions.yaml \\")
        print("    --tags-path aten/src/ATen/native/tags.yaml \\")
        print("    --deprecated-functions-path tools/autograd/deprecated.yaml")
        return 1

    print("\n✓ All stub files present!")
    return 0

if __name__ == "__main__":
    sys.exit(main())
