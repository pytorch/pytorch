name: Label PRs With Reviewers with triaged
on:
  pull_request:
    types: [review_requested, review_request_removed, opened, synchronize, reopened]
jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Add or remove triaged label based on reviewers
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const reviewers = pr.requested_reviewers || [];
            const team_reviewers = pr.requested_teams || [];
            const labels = pr.labels.map(label => label.name);
            // Helper to add triaged label
            async function addTriaged() {
              if (!labels.includes('triaged')) {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: pr.number,
                  labels: ['triaged']
                });
                console.log(`Added 'triaged' label to PR #${pr.number}`);
              }
            }
            // Helper to remove triaged label
            async function removeTriaged() {
              if (labels.includes('triaged')) {
                await github.rest.issues.removeLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: pr.number,
                  name: 'triaged'
                });
                console.log(`Removed 'triaged' label from PR #${pr.number}`);
              }
            }
            // Main logic
            if (reviewers.length > 0 || team_reviewers.length > 0) {
              await addTriaged();
            } else {
              await removeTriaged();
            }
